{"version":3,"file":"ToastProvider.js","sources":["kds-react/src/components/Toast/ToastProvider.js"],"sourcesContent":["import React, { Component } from 'react'\nimport { CSSTransition, TransitionGroup } from 'react-transition-group'\nimport { generateUniqueString } from '../../utils/generationUtils'\nimport { canUseDOM } from '../../utils/windowUtils'\nimport Portal from '../Portal/_Portal'\nimport { Provider } from './_ToastContext'\nimport Toast from './Toast'\n\n/** See [`Toast`](./toast) documentation for further details. */\nclass ToastProvider extends Component {\n  timeoutId = null\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      toasts: []\n    }\n  }\n\n  /** The `add` function can be wrapped around an element that will trigger a `Toast` message. */\n  add = content => {\n    const id = generateUniqueString()\n\n    if (this.state.toasts.length > 0) {\n      this.remove(this.state.toasts[0] && this.state.toasts[0].id)\n    }\n\n    this.setState(state => {\n      const toasts = state.toasts.slice()\n      const toast = { content, id }\n      toasts.push(toast)\n\n      return { toasts }\n    })\n\n    this.timeoutId = setTimeout(\n      this.onDismiss(id),\n      this.readTime(content['text'])\n    )\n  }\n\n  /** Formula to calculate the length of time (ms) a Toast remains onscreen. */\n  readTime = str => {\n    const words = str.split(' ').length\n    return 5000 + words * 300\n  }\n\n  remove = id => {\n    clearTimeout(this.timeoutId)\n\n    this.setState(state => {\n      const toasts = state.toasts.filter(t => t.id !== id)\n      return { toasts }\n    })\n  }\n\n  /** The `onDismiss` function closes the individual `Toast` component. */\n  onDismiss = id => () => {\n    this.remove(id)\n  }\n\n  render () {\n    const { add } = this\n    const { toasts } = this.state\n\n    return (\n      <Provider value={add}>\n        {this.props.children}\n\n        {canUseDOM() ? (\n          <Portal id=\"toast\">\n            <TransitionGroup className=\"kds-ToastGroup\">\n              {toasts.map(({ content, id }) => {\n                return (\n                  <CSSTransition\n                    key={id}\n                    timeout={400}\n                    classNames={{\n                      enter: 'isVisible',\n                      exit: 'isRemoved'\n                    }}\n                  >\n                    <Toast\n                      kind={content.kind}\n                      heading={content.heading}\n                      onClose={this.onDismiss(id)}\n                    >\n                      {content.text}\n                    </Toast>\n                  </CSSTransition>\n                )\n              })}\n            </TransitionGroup>\n          </Portal>\n        ) : null}\n      </Provider>\n    )\n  }\n}\n\nexport default ToastProvider\n"],"names":["ToastProvider","props","content","id","generateUniqueString","state","toasts","length","remove","setState","slice","toast","push","timeoutId","setTimeout","onDismiss","readTime","str","words","split","clearTimeout","filter","t","add","children","canUseDOM","map","enter","exit","kind","heading","text","Component"],"mappings":"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"}