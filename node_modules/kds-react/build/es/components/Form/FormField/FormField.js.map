{"version":3,"file":"FormField.js","sources":["kds-react/src/components/Form/FormField/FormField.js"],"sourcesContent":["import cx from 'classnames'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport {\n  getValueFromTarget,\n  valOrCamelCasedFallback\n} from '../../../utils/formUtils'\nimport { callAll, callSafely } from '../../../utils/functionUtils'\nimport { generateUniqueString } from '../../../utils/generationUtils'\nimport { IconInfo } from '../../Icon/'\nimport Input from '../../Input/Input'\nimport Label from '../../Label/Label'\nimport Link from '../../Link/Link'\nimport Message from '../../Message/Message'\nimport MessageGroup from '../../MessageGroup/MessageGroup'\nimport Paragraph from '../../Paragraph/Paragraph'\nimport * as prebuiltValidations from '../validations/_prebuiltValidations'\n\nconst MoreInfoLink = ({ linkText = 'More Info', content, id }) =>\n  content ? (\n    <Link\n      noRouter\n      onClick={() => alert(content)}\n      size=\"m\"\n      className=\"ml-8\"\n      aria-labelledby={id}\n    >\n      {linkText}\n      <IconInfo className=\"ml-4\" />\n      <span id={id} className=\"screen-reader\">\n        {linkText}, {content}\n      </span>\n    </Link>\n  ) : null\n\nconst getKinds = (target, validations, invalidKind) => {\n  // Evaluate the value once outside of the map for better perf\n  const value = getValueFromTarget(target)\n\n  return validations.map(({ validate }) => {\n    const valid = callSafely(validate)(value)\n\n    return valid ? 'success' : invalidKind\n  })\n}\n\nconst _shouldShowMessages = (showMessages, currentState, nextState) => {\n  const { focused, validationError } = {\n    ...currentState,\n    ...nextState\n  }\n\n  if (validationError) {\n    return true\n  }\n\n  if (showMessages === 'onFocus') {\n    return focused\n  }\n}\n\nconst ValidationMessages = ({\n  id,\n  shouldShowMessages,\n  validations,\n  messageKinds,\n  focused,\n  invalid,\n  shouldShowAdaAlert,\n  screenReaderMessages,\n  ...props\n}) =>\n  shouldShowMessages && validations.length > 0 ? (\n    <React.Fragment>\n      {/*\n       * These are the visual messages only, screenreader messaging is below.\n       * Note the aria-hidden=\"true\" attr on this MessageGroup\n       */}\n      <MessageGroup {...props} aria-hidden=\"true\">\n        {validations.map(({ text }, index) => {\n          const kind = messageKinds[index]\n\n          return (\n            <Message key={index} kind={kind}>\n              {text}\n            </Message>\n          )\n        })}\n      </MessageGroup>\n      {/*\n       * If we are focused on the input we want to have the messages screenread\n       * as an aria-describedby description. So we are rendering a div with an\n       * id that will be used within underlying Component's aria-describedby attribute.\n       */\n        focused && shouldShowMessages && (\n          <div id={id} data-testid={id} className=\"screen-reader\">\n            {screenReaderMessages}\n          </div>\n        )}\n      {/*\n       * If we are NOT focused on the input and it is invalid, we want to have\n       * the messages be \"alerted\" via aria-live=\"assertive\".\n       */\n        invalid && !focused && shouldShowAdaAlert && (\n          <div\n            id={`${id}-alert`}\n            aria-live=\"assertive\"\n            aria-relevant=\"all\"\n            aria-atomic=\"true\"\n            className=\"screen-reader\"\n          >\n            {screenReaderMessages}\n          </div>\n        )}\n    </React.Fragment>\n  ) : null\n\n/**\n * By default, `FormField` will add an [`Input`](./input) to a [`Form`](./form).\n * You can pass a component through the `as` prop, which will be rendered instead of `Input`, like so:\n * > `<FormField as={MyInputComponent}  {...props} />`.\n\n *\n * It comes with accessible form features:\n *\n * - label and description\n * - validation messaging\n * - aria attributes\n *\n * All additional props beyond what is specified below will be spread onto the underlying Input (or your custom component), like so:\n * > `<Input {...props} />`.\n *\n * **Requires *custom-event* polyfill for custom validations to work in IE11** [See Polyfills](./polyfills)\n */\nclass FormField extends React.Component {\n  id = `${generateUniqueString()}-input`\n\n  constructor (props) {\n    super(props)\n    const { required, validations } = props\n    const { addRequiredToValidations } = prebuiltValidations\n    this._validations = required\n      ? addRequiredToValidations(validations)\n      : validations\n\n    this.state = {\n      messageKinds: this._validations.map(() => 'info'),\n      focused: false,\n      validationError: false,\n      shouldShowMessages: false,\n      shouldShowAdaAlert: false\n    }\n\n    this.inputRef = props.inputRef || React.createRef()\n  }\n\n  componentDidMount () {\n    if (this.inputRef && this.inputRef.current) {\n      const el = this.inputRef.current\n      const oldFn = el.checkValidity.bind(el)\n      el.checkValidity = () => {\n        const messageKinds = getKinds(el, this._validations, 'error')\n        const validationError = messageKinds.some(kind => kind === 'error')\n        this.setState({\n          messageKinds,\n          validationError,\n          shouldShowMessages: _shouldShowMessages(\n            this.props.showMessages,\n            this.state,\n            {\n              validationError\n            }\n          )\n        })\n\n        return !validationError && oldFn()\n      }\n\n      el.restoreDefaultState = () => {\n        this.setState({\n          messageKinds: this._validations.map(() => 'info'),\n          focused: false,\n          shouldShowMessages: false,\n          shouldShowAdaAlert: false,\n          submitError: false\n        })\n      }\n    }\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    const shouldSetFocus =\n      typeof this.props.focusOn !== 'undefined'\n        ? !prevProps.focusOn && this.props.focusOn\n        : (!prevProps.serverMessages ||\n            prevProps.serverMessages.length === 0) &&\n          this.props.serverMessages &&\n          this.props.serverMessages.length > 0\n    const previousKinds = prevState.messageKinds\n    const messageKindsChanged =\n      this.state.messageKinds\n        .map((currentKind, index) => currentKind === previousKinds[index])\n        .filter(same => !same).length > 0\n\n    if (messageKindsChanged) {\n      const payload = {\n        messagesShown: this.state.shouldShowMessages && this.state.messageKinds\n      }\n      let validationEvent\n\n      try {\n        validationEvent = new CustomEvent('validation', {\n          bubbles: true,\n          detail: payload\n        })\n      } catch (e) {\n        throw new Error(\n          'KDS FormField validations error. You may need the custom-event polyfill http://design.kroger.com/#/react/components/polyfills'\n        )\n      }\n\n      this.inputRef.current.setAttribute(\n        'data-messagesShown',\n        JSON.stringify(\n          this.state.shouldShowMessages\n            ? this.state.messageKinds.map((kind, index) => ({\n              messageText: this._validations[index].text,\n              messageKind: kind\n            }))\n            : []\n        )\n      )\n      this.inputRef.current.dispatchEvent(validationEvent)\n    }\n\n    if (shouldSetFocus) {\n      setTimeout(() => {\n        this.inputRef.current.focus()\n      }, 0)\n    }\n  }\n\n  handleFocus = () => {\n    const { shouldShowMessages } = this.state\n    const nextMeta = { focused: true }\n\n    this.setState({\n      ...nextMeta,\n      shouldShowMessages:\n        shouldShowMessages ||\n        _shouldShowMessages(this.props.showMessages, this.state, nextMeta),\n      shouldShowAdaAlert: false\n    })\n  }\n\n  handleChange = event => {\n    const { validationError } = this.state\n    const messageKinds = getKinds(\n      event.target,\n      this._validations,\n      validationError ? 'error' : 'info'\n    )\n    const messageKindsChanged =\n      this.state.messageKinds\n        .map((currentKind, index) => currentKind === messageKinds[index])\n        .filter(same => !same).length > 0\n    if (messageKindsChanged) {\n      this.setState({ messageKinds })\n    }\n  }\n\n  handleBlur = event => {\n    this.setState({\n      focused: false\n    })\n    setTimeout(\n      () =>\n        this.setState(prevState => ({\n          ...prevState,\n          shouldShowAdaAlert: true\n        })),\n      250\n    )\n  }\n\n  render () {\n    let {\n      as: Component,\n      name,\n      label,\n      required: requiredProp,\n      validations,\n      showMessages,\n      className,\n      moreInfo,\n      helpText,\n      button,\n      inputRef,\n      serverMessages = [],\n      ...props\n    } = this.props\n\n    const {\n      messageKinds,\n      focused,\n      validationError,\n      shouldShowMessages,\n      shouldShowAdaAlert\n    } = this.state\n\n    const required = prebuiltValidations.contains(\n      this._validations,\n      prebuiltValidations.required\n    )\n\n    const serverError = serverMessages.length > 0\n    const invalid =\n      serverError ||\n      (validationError && messageKinds.some(kind => kind === 'error'))\n    const metaClasses = cx({\n      'is-invalid': invalid,\n      'is-focused': focused,\n      'is-required': required\n    })\n\n    const screenReaderMessages = (!validationError && serverError\n      ? serverMessages\n      : this._validations\n        .filter((_, i) => messageKinds[i] !== 'success')\n        .map(({ text }) => text)\n    ).join('. ')\n\n    const id = props.id || this.id\n    const helpTextId = helpText ? `${id}-helpText` : ''\n    const moreInfoId = moreInfo ? `${id}-moreInfo` : ''\n    const messagesId = shouldShowMessages || serverError ? `${id}-messages` : ''\n    /* Create a space-separated list of ids or an empty string.\n    // Order matters for AT users. Please preserve: help text, more info, validation messages */\n    const ariaDescribedbyIds = [helpTextId, moreInfoId, messagesId]\n      .join(' ')\n      .trim()\n\n    const IconButton = button && standardizeIconButton(button, id)\n\n    return (\n      <div\n        className={cx('kds-Form--field kds-FormField', metaClasses, className)}\n      >\n        {label && (\n          <span className=\"flex\">\n            <Label htmlFor={id} className=\"mb-8\">\n              {label}\n            </Label>\n            <MoreInfoLink id={moreInfoId} {...moreInfo} />\n          </span>\n        )}\n\n        {helpText && (\n          <Paragraph id={helpTextId} size=\"s\" className=\"-mt-4 mb-8\">\n            {helpText}\n          </Paragraph>\n        )}\n\n        <div className=\"kds-FormField-inputWrapper flex items-center\">\n          <Component\n            {...props}\n            ref={this.inputRef}\n            id={id}\n            name={valOrCamelCasedFallback(name, label)}\n            aria-describedby={ariaDescribedbyIds || null}\n            aria-invalid={invalid}\n            aria-required={required}\n            onFocus={callAll(this.handleFocus, this.props.onFocus)}\n            onChange={callAll(this.handleChange, this.props.onChange)}\n            onBlur={callAll(this.handleBlur, this.props.onBlur)}\n            className={cx(button && 'kds-FormField-input--withIconButton')}\n          />\n          {IconButton}\n        </div>\n        <ValidationMessages\n          id={messagesId}\n          shouldShowMessages={shouldShowMessages || serverError}\n          validations={\n            !validationError && serverError\n              ? serverMessages.map(text => ({ text }))\n              : this._validations\n          }\n          messageKinds={\n            !validationError && serverError\n              ? serverMessages.map(() => 'error')\n              : messageKinds\n          }\n          focused={focused}\n          invalid={invalid}\n          shouldShowAdaAlert={shouldShowAdaAlert}\n          screenReaderMessages={screenReaderMessages}\n        />\n      </div>\n    )\n  }\n}\n\nFormField.propTypes = {\n  /** The component to be rendered instead of Input. */\n  as: PropTypes.any,\n  /** Text for this field's label. Do **not** put a colon at the end of the label. */\n  label: PropTypes.string.isRequired,\n  /** Name for this field. Will be used as the key in the form data object passed to the `onSubmit` handler. Defaults to the value of the `label` prop. */\n  name: PropTypes.string,\n  /** If `true`, then this input will be required and show a message that it is required. */\n  required: PropTypes.bool,\n  /** An array of pre-built [`Form.validations`](./forminput#Validations) and/or [custom validations](./forminput#Custom%20Validations),\n   * where `text` is the message to show, and `validate` is a predicate to test for the validation's\n   * success state.\n   * **Requires *custom-event* polyfill to work in IE11** [See Polyfills](./polyfills) */\n  validations: PropTypes.arrayOf(\n    PropTypes.shape({\n      text: PropTypes.string.isRequired,\n      validate: PropTypes.func.isRequired\n    })\n  ),\n  /** An additional event for which you'd like to show the validation messages. All validation messages will also be shown on *Form* submit by default. */\n  showMessages: PropTypes.oneOf(['onFocus']),\n  /** A list of server error messages to display to the user. **Must** clear on every submit, **Only** provide when server response returns with error */\n  serverMessages: PropTypes.arrayOf(PropTypes.string),\n  /** Sets focus on this field if there are any server error messages. **Only** provide to one field at a time in the form. */\n  focusOn: PropTypes.bool,\n  /** Text to accompany the input label for a more detailed description. */\n  helpText: PropTypes.string,\n  /** Adds a \"More Info\" link that shows a modal with content for long additional information. */\n  moreInfo: PropTypes.shape({\n    linkText: PropTypes.string,\n    content: PropTypes.string.isRequired\n  }),\n  /** Adds an Icon Button to the right side of the input.\n   * Should always be something like `<Button><Icon /></Button>` */\n  button: PropTypes.element,\n  /** Reference to the underlying input */\n  inputRef: PropTypes.ref\n}\n\nFormField.defaultProps = {\n  as: Input,\n  validations: []\n}\n\nfunction standardizeIconButton (button, inputId) {\n  const onlyButton = React.Children.only(button)\n  const onlyIcon = React.Children.only(button.props.children)\n\n  return React.cloneElement(onlyButton, {\n    ...onlyButton.props,\n    kind: 'tertiary',\n    type: 'button',\n    'aria-controls': inputId,\n    className: cx('kds-FormField-iconButton', onlyButton.props.className),\n    children: React.cloneElement(onlyIcon, {\n      ...onlyIcon.props,\n      size: 'm',\n      className: cx('kds-FormField-icon', onlyIcon.props.className),\n      color: 'interactive'\n    })\n  })\n}\n\nexport default FormField\n"],"names":["MoreInfoLink","linkText","content","id","alert","getKinds","target","validations","invalidKind","value","getValueFromTarget","map","validate","valid","callSafely","_shouldShowMessages","showMessages","currentState","nextState","focused","validationError","ValidationMessages","shouldShowMessages","messageKinds","invalid","shouldShowAdaAlert","screenReaderMessages","props","length","index","text","kind","FormField","generateUniqueString","state","nextMeta","setState","event","_validations","messageKindsChanged","currentKind","filter","same","setTimeout","prevState","required","addRequiredToValidations","prebuiltValidations","inputRef","React","createRef","current","el","oldFn","checkValidity","bind","some","restoreDefaultState","submitError","prevProps","shouldSetFocus","focusOn","serverMessages","previousKinds","payload","messagesShown","validationEvent","CustomEvent","bubbles","detail","e","Error","setAttribute","JSON","stringify","messageText","messageKind","dispatchEvent","focus","Component","as","name","label","requiredProp","className","moreInfo","helpText","button","serverError","metaClasses","cx","_","i","join","helpTextId","moreInfoId","messagesId","ariaDescribedbyIds","trim","IconButton","standardizeIconButton","valOrCamelCasedFallback","callAll","handleFocus","onFocus","handleChange","onChange","handleBlur","onBlur","defaultProps","Input","inputId","onlyButton","Children","only","onlyIcon","children","cloneElement","type","size","color"],"mappings":"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"}