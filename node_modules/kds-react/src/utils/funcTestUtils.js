function fireEvent (selector, name, data) {
  browser.execute((selector, name, data) => {
    const event = new Event(name, data)

    document.querySelector(selector).dispatchEvent(event)
  }),
  selector,
  name,
  data
}

function renderInSandbox (code) {
  const previewSelector =
    '.react-live.LiveProvider .react-live-preview.LiveProvider-preview.LiveProvider-preview--editor'
  const codeInputSelector =
    '.react-live.LiveProvider pre.prism-code.LiveProvider-editor'

  const preview = browser.execute(
    (code, previewSelector, codeInputSelector) => {
      const previewEl = document.querySelector(previewSelector)
      const codeInputEl = document.querySelector(codeInputSelector)

      codeInputEl.textContent = code

      const keyDownEvent = new KeyboardEvent('keydown', {
        keyCode: 13,
        bubbles: true
      })
      const keyUpEvent = new KeyboardEvent('keyup', {
        keyCode: 13,
        bubbles: true
      })

      codeInputEl.dispatchEvent(keyDownEvent)
      codeInputEl.dispatchEvent(keyUpEvent)

      return previewEl
    },
    code,
    previewSelector,
    codeInputSelector
  )

  return $(previewSelector)
}

function getUrl () {
  return browser.execute(() => window.location.toString())
}

module.exports = {
  renderInSandbox,
  getUrl,
  fireEvent
}
