import React from 'react'
import PopoverMenu from './_PopoverMenu'
import Button from '../Button/Button'
import Link from '../Link/Link'
import { render } from 'react-testing-library'

function renderMenu () {
  return render(
    <PopoverMenu toggleButton={<Button className="toggle">Toggle Menu</Button>}>
      <Link className="link-1">link 1</Link>
      <Link className="link-2">link 2</Link>
    </PopoverMenu>
  )
}

describe('<PopoverMenu />', () => {
  it('renders a wrapper with a button inside', () => {
    const { container } = renderMenu()

    expect(container.firstChild).toHaveClass('kds-PopoverMenu-wrapper')
    expect(container.firstChild.firstChild).toHaveClass('toggle')
  })

  it('toggles a Menu when button is clicked', () => {
    const { container } = renderMenu()

    expect(container.querySelector('.kds-Menu')).toBeNull()

    container.querySelector('.toggle').click()
    expect(container.querySelector('.kds-Menu').children).toHaveLength(2)

    container.querySelector('.toggle').click()
    expect(container.querySelector('.kds-Menu')).toBeNull()
  })

  it('Calls the onClick method on the toggle button when clicked', () => {
    const mockFn = jest.fn()
    const { container } = render(
      <PopoverMenu
        toggleButton={
          <Button onClick={mockFn} className="toggle">
            Toggle Menu
          </Button>
        }
      />
    )

    container.querySelector('.toggle').click()
    expect(mockFn).toBeCalled()
  })

  it('Hides the Menu when a link is clicked', () => {
    const { container } = renderMenu()

    container.querySelector('.toggle').click()
    expect(container.querySelector('.kds-Menu').children).toHaveLength(2)

    container.querySelector('.link-1').click()
    expect(container.querySelector('.kds-Menu')).toBeNull()
  })

  it('Calls the onClick method on the link when clicked', () => {
    const mockFn = jest.fn()
    const { container } = render(
      <PopoverMenu
        toggleButton={<Button className="toggle">Toggle Menu</Button>}
      >
        <Link className="link-1" onClick={mockFn}>
          link 1
        </Link>
      </PopoverMenu>
    )

    container.querySelector('.toggle').click()
    container.querySelector('.link-1').click()
    expect(mockFn).toBeCalled()
  })
})
