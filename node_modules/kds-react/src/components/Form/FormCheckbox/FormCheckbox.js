import PropTypes from 'prop-types'
import React from 'react'
import { valOrCamelCasedFallback } from '../../../utils/formUtils'
import { isTruthyOrZero } from '../../../utils/objectUtils'
import Checkbox from '../../Checkbox/Checkbox'
import Label from '../../Label/Label'
import { addRequiredToValidations } from '../validations/_prebuiltValidations'
import FormField from '../FormField/FormField'

export const CHECKBOX_REQUIRED_DEFAULT_TEXT = 'Check mark is required.'

const CheckboxWithLabel = React.forwardRef(
  ({ checkboxLabel, name, value, ...props }, ref) => (
    <Label>
      <Checkbox
        ref={ref}
        {...props}
        name={valOrCamelCasedFallback(name, checkboxLabel)}
        value={isTruthyOrZero(value) ? value : checkboxLabel}
      />
      {checkboxLabel}
    </Label>
  )
)

/**
 * `FormCheckbox` will add a checkbox to a [`Form`](./form).
 *
 * > **Note:** `<FormCheckbox />` renders a `<FormField />` with most props spread on.
 * For more details, see the [FormField](./formfield) and [`Checkbox`](./checkbox) components.
 *
 * It comes with accessible form features:
 *
 * - label
 * - validation messaging
 * - aria attributes
 *
 * **Requires *custom-event* polyfill for custom validations to work in IE11** [See Polyfills](./polyfills)
 */

const FormCheckbox = ({ label, required, validations, ...props }) => (
  <FormField
    {...props}
    as={CheckboxWithLabel}
    checkboxLabel={label}
    validations={
      required
        ? addRequiredToValidations(validations, CHECKBOX_REQUIRED_DEFAULT_TEXT)
        : validations
    }
  />
)

FormCheckbox.propTypes = {
  /** Text for this field's label. */
  label: PropTypes.string.isRequired,
  /** Name for this field. Will be used as the key in the form data object passed to the `onSubmit` handler. Defaults to the value of the `label` prop. */
  name: PropTypes.string,
  /** Set to `true` if this checkbox is required to be checked. Use `validations` prop if you need a custom validation message. */
  required: PropTypes.bool
}

export default FormCheckbox
