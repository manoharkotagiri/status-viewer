import React, { Component } from 'react'
import ReactDOM from 'react-dom'
import PropTypes from 'prop-types'
import { getWindow, canUseDOM } from '../../utils/windowUtils'

class Portal extends Component {
  static propTypes = {
    /** Declare an ID for your Portal using this prop */
    id: PropTypes.string
  }

  static defaultProps = {
    id: 'default'
  }

  UNSAFE_componentWillMount () {
    let id = `kds-Portal-${this.props.id}`
    const { className } = this.props
    let window = getWindow()

    if (!canUseDOM()) {
      return
    }

    let portalEl = window.document.getElementById(id)

    if (!portalEl) {
      portalEl = window.document.createElement('div')
      portalEl.setAttribute('id', id)
      portalEl.setAttribute(
        'class',
        `kds-Portal pointer-events-none ${className}`
      )
      window.document.body.appendChild(portalEl)
    }

    this.portalEl = portalEl
  }

  render () {
    if (!this.portalEl) {
      return null
    }

    return ReactDOM.createPortal(this.props.children, this.portalEl)
  }
}

export default Portal
