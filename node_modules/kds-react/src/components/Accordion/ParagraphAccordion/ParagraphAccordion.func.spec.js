const { renderInSandbox } = require('../../../utils/funcTestUtils')
const assert = require('assert')

describe('<ParagraphAccordion /> functional tests', () => {
  const baseUrl = 'http://localhost:3000'
  const testBenchUrl = baseUrl + '/#/react/test-bench'
  beforeEach(() => {
    browser.url(testBenchUrl)
    $('.react-live.LiveProvider').waitForExist(
      5000,
      false,
      'test bench did not load'
    )
  })

  describe('onClick of CTA button', () => {
    it('calls onClick prop', () => {
      const wrapper = renderInSandbox(`
        <ParagraphAccordion onClick={() => {
          const el = document.createElement('output')
          el.setAttribute('id', 'clickOutput')
          document.body.appendChild(el)
        }} leadingText={<Paragraph>
          Lorem ipsum.
        </Paragraph>}>
          <Paragraph>
            Lorem ipsum.
          </Paragraph>
        </ParagraphAccordion>
      `)

      $('.kds-ParagraphAccordion-ctaButton').click()

      assert($('#clickOutput').isExisting())

      browser.execute(() => {
        const clickOutput = document.querySelector('#clickOutput')

        clickOutput && document.body.removeChild(clickOutput)
      })
    })

    it('toggles its open state and visibility', () => {
      const wrapper = renderInSandbox(`
        <ParagraphAccordion leadingText={<Paragraph>Cool leading text</Paragraph>}>
          <Paragraph>
            Lorem ipsum.
          </Paragraph>
        </ParagraphAccordion>
      `)
      const ctaButtonNodeSelector = '.kds-ParagraphAccordion-ctaButton'
      const contentNodeSelector = '.kds-ParagraphAccordion-content'

      assert(!$(contentNodeSelector).isDisplayed())

      $(ctaButtonNodeSelector).click()
      // Wait for animation to complete
      browser.executeAsync(done => {
        setTimeout(done, 500)
      })
      assert($(contentNodeSelector).isDisplayed())

      $(ctaButtonNodeSelector).click()
      // Wait for animation to complete
      browser.executeAsync(done => {
        setTimeout(done, 500)
      })
      assert(!$(contentNodeSelector).isDisplayed())
    })
  })
})
